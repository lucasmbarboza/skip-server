# Configuração do Splunk para monitorar logs dos dois servidores SKIP
# Este arquivo deve ser copiado para $SPLUNK_HOME/etc/system/local/inputs.conf

# Monitoramento do skip_server_1
[monitor:///opt/splunk/var/log/skip/server1/skip.logs]
disabled = false
index = main
sourcetype = skip_server_logs
host = skip_server_1
source = skip_server_1

# Monitoramento do skip_server_2
[monitor:///opt/splunk/var/log/skip/server2/skip.logs]
disabled = false
index = main
sourcetype = skip_server_logs
host = skip_server_2
source = skip_server_2

# Monitoramento geral de todos os logs da pasta (fallback)
[monitor:///opt/splunk/var/log/skip/.../*.logs]
disabled = false
index = main
sourcetype = skip_server_logs
recursive = true

# Configuração para parsing de logs estruturados
[skip_server_logs]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
TIME_FORMAT = %Y-%m-%d %H:%M:%S,%3N
TIME_PREFIX = ^
MAX_TIMESTAMP_LOOKAHEAD = 25
TRUNCATE = 10000

# Extrações de campos para melhor análise
EXTRACT-server_id = \[(?<server_id>[^\]]+)\]
EXTRACT-log_level = - (?<log_level>DEBUG|INFO|WARNING|ERROR|CRITICAL) -
EXTRACT-logger_name = - (?<logger_name>[\w\.]+) - \w+ -

# Extrações específicas para diferentes tipos de eventos
EXTRACT-request_info = REQUEST \| method=(?<http_method>\w+) \| path=(?<http_path>[^\s]+) \| args=(?<http_args>[^|]+) \| remote_addr=(?<remote_addr>[^\s]+)
EXTRACT-response_info = RESPONSE \| status_code=(?<status_code>\d+) \| content_length=(?<content_length>\d+)
EXTRACT-key_generated = KEY_GENERATED \| key_id=(?<key_id>\w+) \| size=(?<key_size>\d+) \| remote_system_id=(?<remote_system_id>\w+)
EXTRACT-key_retrieved = KEY_RETRIEVED \| key_id=(?<key_id>\w+) \| remote_system_id=(?<remote_system_id>\w+)
EXTRACT-key_zeroized = KEY_ZEROIZED \| key_id=(?<key_id>\w+)
EXTRACT-entropy_generated = ENTROPY_GENERATED \| min_entropy=(?<min_entropy>\d+)

# Definir tipos de eventos
EVAL-event_type = case(
    match(_raw, "REQUEST"), "http_request",
    match(_raw, "RESPONSE"), "http_response", 
    match(_raw, "KEY_GENERATED"), "key_generation",
    match(_raw, "KEY_RETRIEVED"), "key_retrieval",
    match(_raw, "KEY_ZEROIZED"), "key_zeroization",
    match(_raw, "ENTROPY_GENERATED"), "entropy_generation",
    1=1, "general"
)